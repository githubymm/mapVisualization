<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>湖南地图可视化</title>
	<script type="text/javascript" src="lib/d3/d3.js"></script>
	<style type="text/css">
		.location circle {
			fill:black;
		}
		.location text {
			font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  			font-size: 10px;
  			pointer-events: none;
		}
	</style>
</head>
<body>
	<a href="chinamap.html">中国地图</a>
	<a href="changshamap.html">长沙地图</a>
	<script >
		var width=1000;
		var height=1000;

		var svg=d3.select('body').append('svg')
				.attr('width', width)
				.attr('height',height)
				.append('g')
				.attr('transform','translate(0,0)');

		//定义一个地理投影，用来将经纬度数据转换为二维坐标
		//mercator()投影函数
		//center()设定地图的中心位置，[120,35]指经纬度
		var projection=d3.geo.mercator()
						.center([112,26])
						.scale(5000)
						.translate([width/2,height/2]);
		//定义地理路径生成器，需绑定之前定义的地理投影
		//projection()是设定生成器的投影函数
		var path=d3.geo.path()
				.projection(projection);

		var color=d3.scale.category20();

		d3.json("data/hunan.json",function(error,china){
			if(error){
				return console.error(error);
			}
			// 绘制湖南省地图
			svg.selectAll("path")
				.data(china.features)
				.enter()
				.append('path')
				.attr('stroke','#fff')
				.attr('stroke-width',.5)
				.attr('fill','#ddc')
				.attr('d', path)
				.on('mouseover',function(d,i){
					d3.select(this).attr('fill','yellow');
				})
				.on('mouseout',function(d,i){
					d3.select(this).attr('stroke-width',0).attr('fill',color(i))
				});

			// 插入分组元素,湖南各市地点
			var location=svg.selectAll('.location')
						.data(china.features)
						.enter()
						.append('g')
						.attr('class', 'location')
						.attr('transform', function(d){
							var coor=projection(d.properties.cp);
							return 'translate('+coor[0]+','+coor[1]+')';
						});

			location.append('circle').attr('r', '2');
			location.append('text')
					.attr({
						'x':function(d){return (d.properties.id % 2 ==0) ? 5 : -15;},
						'y':-10,
						'dy':'.35em'
					})
					.style({
						'text-anchor':function(d){return d.properties.name.length <4 ? 'start':'middle';},
						'writing-mode':function(d){if(d.properties.name.length>4)return 'tb';}
						
					})
					.text(function(d){return d.properties.name});
		});
	</script>
</body>
</html>